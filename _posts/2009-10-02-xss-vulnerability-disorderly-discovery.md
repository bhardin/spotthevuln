---
layout: post
title: Disorderly Discovery - XSS
tags:
- Cross-Site Scripting (XSS)
- Java
- Solution
status: publish
type: post
published: true
meta:
  aktt_notify_twitter: 'yes'
  _aktt_hash_meta: ''
  _edit_last: '1'
  _headspace_page_title: Cross-Site Scripting (XSS) Vulnerability Code Example
  aktt_tweeted: '1'
  _headspace_description: Cross-Site Scripting (XSS) Vulnerability Code Example
  _sexybookmarks_permaHash: 68689a81ceea73551656790fb37020da
  _sexybookmarks_shortUrl: http://bit.ly/dx2DT7
---
## Details
<strong>__Affected Software:__ <a href="http://spotthevuln.com/category/software/java/">JSPWiki</a></strong>

__Fixed in Version:__  2.5.164

<strong>__Issue Type:__</strong> <a href="http://spotthevuln.com/category/vulnerability/xss/">Cross Site Scripting (XSS)</a>

<strong>Original Code: </strong><a href="http://spotthevuln.com/2009/09/vulnerable-code-disorderly-discovery/">Found Here</a>
## Description
This is a classic XSS vulnerability which affected JSPWiki.

The setId() method assigns a non-sanitized value to the m_tabID variable. The m_tabID variable is then later used in the doWikiStartTag() method as part of a stringbuffer which is used to build dynamic HTML.  The m_tabID variable is never encoded or sanitized before being echoed back to the user.

In addition, to the setId() method, the setTitle(), setAccessKey(), and setUrl() methods also expose a potential for XSS.  The JSPWiki team used TextUtil.replaceEntities() in each of the vulnerable methods to sanitize the values being assigned to the respective variables.

<strong>If you had to write the TextUtil.replaceEntities() method, what would it look like?</strong>
<h2>Developers Solution</h2>
[cce lang="diff"]
public class TabTag extends WikiTagBase {
private static final long serialVersionUID = -8534125226484616489L;
private String m_accesskey;
private String m_tabID;
private String m_tabTitle;
private String m_url;

public void setId(String aTabID)
{
-    m_tabID = aTabID;
+    m_tabID = TextUtil.replaceEntities( aTabID );
}

public void setTitle(String aTabTitle)
{
-       m_tabTitle = aTabTitle;
+       m_tabTitle = TextUtil.replaceEntities( aTabTitle );
}

public void setAccesskey(String anAccesskey)
{
-       m_accesskey = anAccesskey; //take only the first char
+       m_accesskey = TextUtil.replaceEntities( anAccesskey ); //take only the first char
}

public void setUrl( String url )
{
-       m_url = url;
+       m_url = TextUtil.replaceEntities( url );
}

public int doWikiStartTag() throws JspTagException {
TabbedSectionTag parent = (TabbedSectionTag) findAncestorWithClass(
this, TabbedSectionTag.class);

if (m_tabID == null) {
throw new JspTagException("Tab Tag without \"id\" attribute");
}
if (m_tabTitle == null) {
throw new JspTagException("Tab Tag without \"tabTitle\" attribute");
}
if (parent == null) {
throw new JspTagException(
"Tab Tag without parent \"TabbedSection\" Tag");
}

if (!parent.isStateGenerateTabBody())
return SKIP_BODY;

StringBuffer sb = new StringBuffer(32);

sb.append("&lt;div id=\"" + m_tabID + "\"");

if (!parent.validateDefaultTab(m_tabID)) {
sb.append(" class=\"hidetab\"");
}
sb.append(" &gt;\n");

try {
pageContext.getOut().write(sb.toString());
} catch (java.io.IOException e) {
throw new JspTagException("IO Error: " + e.getMessage());
}

return EVAL_BODY_INCLUDE;
}

}

[/cce] 
