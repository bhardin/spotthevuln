---
layout: post
title: Vulnerability - Cross Site Scripting
tags:
- All
- attacker
- automation
- cross site scripting
- Cross-Site Scripting (XSS)
- markup
- PHP
- red flags
- test cases
- Wordpress
status: publish
type: post
published: true
meta:
  _syntaxhighlighter_encoded: '1'
  _edit_last: '2'
  _aktt_hash_meta: ! '#secure #code #dev'
  aktt_notify_twitter: 'yes'
  _sexybookmarks_shortUrl: http://bit.ly/bXaXdw
  aktt_tweeted: '1'
  _wp_old_slug: ''
  _sexybookmarks_permaHash: 76cda016e578d1089f292b5c6d4641c1
---
## Details
Affected Software: Wordpress (Core)

Fixed in Version: 2.3

Issue Type: Cross Site Scripting (XSS)

Original Code: <a title="Vulnerability" href="http://spotthevuln.com/2010/11/vulnerability/" target="_blank">Found    Here</a>
<h2>Description</h2>
Interesting bug here, not because of the technical details associated with the bug but more of the process associated with code check in process.  First, the bug is simple, after looking through the code we see a single line that outputs POST and GET parameters into HTML markup.  Although the user controlled values are enclosed within HTML comments, the comment tokens do little to prevent XSS as an attacker can simply break out of the HTML comments.

What's surprising here is the line of code that causes the XSS appears to be some kind of debugging statement.  Debugging is a necessary function in any large/complex software project.  Developers should have a standard way to tag debugging functionality so that it doesn't accidently make its way into production builds.  If the debugging functionality were tagged/marked, it would be easy to identify and could have been flagged by simple automation before/during check in time.  This bug also shows that the organization likely doesn't have robust testing program.  A quick buddy test of this page would have likely identified this issue and it could have been removed.   I'm also guessing that this debugging functionality doesn't have any test cases associated with it, which would have raised more red flags.

<h2>Developers Solution</h2>
[sourcecode language="diff"]
&lt;?php

	function convert_all_confirm() {
		print '&lt;div class=&quot;narrow&quot;&gt;';

		print '&lt;h3&gt;' . __('Confirm') . '&lt;/h3&gt;';

		print '&lt;p&gt;' . __('You are about to convert all categories to tags. Are you sure you want to continue?') . '&lt;/p&gt;';

		print '&lt;form action=&quot;admin.php?import=wp-cat2tag&quot; method=&quot;post&quot;&gt;';
		print '&lt;p style=&quot;text-align:center&quot; class=&quot;submit&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;' . __('Yes') . '&quot; name=&quot;yes_convert_all_cats&quot; /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;input type=&quot;submit&quot; value=&quot;' . __('No') . '&quot; name=&quot;no_dont_do_it&quot; /&gt;&lt;/p&gt;';
		print '&lt;/form&gt;';

		print '&lt;/div&gt;';
	}

	function convert_all() {
		global $wpdb;

		$wpdb-&gt;query(&quot;UPDATE $wpdb-&gt;term_taxonomy SET taxonomy = 'post_tag', parent = 0 WHERE taxonomy = 'category'&quot;);
		clean_category_cache($category-&gt;term_id);
	}

	function init() {
-		echo '&lt;!--'; print_r($_POST); print_r($_GET); echo '--&gt;';

		if (isset($_POST['maybe_convert_all_cats'])) {
			$step = 3;
		} elseif (isset($_POST['yes_convert_all_cats'])) {
			$step = 4;
		} elseif (isset($_POST['no_dont_do_it'])) {
			die('no_dont_do_it');
		} else {
			$step = (isset($_GET['step'])) ? (int) $_GET['step'] : 1;
		}

		$this-&gt;header();

		if (!current_user_can('manage_categories')) {
			print '&lt;div class=&quot;narrow&quot;&gt;';
			print '&lt;p&gt;' . __('Cheatin&amp;#8217; uh?') . '&lt;/p&gt;';
			print '&lt;/div&gt;';
		} else {
			switch ($step) {
				case 1 :
					$this-&gt;welcome();
				break;

				case 2 :
					$this-&gt;convert_them();
				break;

				case 3 :
					$this-&gt;convert_all_confirm();
				break;

				case 4 :
					$this-&gt;convert_all();
				break;
			}
		}

		$this-&gt;footer();
	}

	function WP_Categories_to_Tags() {
		// Do nothing.
	}
}

$wp_cat2tag_importer = new WP_Categories_to_Tags();

register_importer('wp-cat2tag', __('Categories to Tags Converter'), __('Convert existing categories to tags, selectively.'), array(&amp;$wp_cat2tag_importer, 'init'));

?&gt;
[/sourcecode] 
